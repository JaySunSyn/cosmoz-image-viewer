<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">

<link rel="import" href="swiper-boilerplate.html">

<dom-module id="cosmoz-swiper">
    <template>
        <style include="swiper-boilerplate">
            :host {
                background: #000;
                font-size: 14px;
                color:#000;
                margin: 0;
                padding: 0;
            }
            .swiper-container {
                width: 100%;
                height: 300px;
                margin-left: auto;
                margin-right: auto;
            }
            .swiper-slide {
                background-size: cover;
                background-position: center;
            }
            .gallery-top {
                height: 80%;
                width: 100%;
            }
            .gallery-thumbs {
                height: 20%;
                box-sizing: border-box;
                padding: 10px 0;
            }
            .gallery-thumbs .swiper-slide {
                width: 25%;
                height: 100%;
                opacity: 0.4;
            }
            .gallery-thumbs .swiper-slide-active {
                opacity: 1;
            }
            .swiper-button {
                color: #fff;
                height: 48px;
                width: 48px;
                margin-right: -12px;
            }
            .swiper-button-next {
                margin-right: -12px;
            }
            .swiper-button-prev {
                margin-left: -12px;
            }
        </style>

        <!-- Swiper -->
        <div class="swiper-container gallery-top">
            <div class="swiper-wrapper">
                <template is="dom-repeat" items="[[images]]" as="image">
                    <img class="swiper-slide" src$="[[_getPath(image)]]">
                </template>
            </div>
            <!-- Add Arrows -->
            <paper-icon-button class="swiper-button swiper-button-next" icon="icons:arrow-forward"></paper-icon-button>
            <paper-icon-button class="swiper-button swiper-button-prev" icon="icons:arrow-back"></paper-icon-button>
        </div>
        <div class="swiper-container gallery-thumbs">
            <div class="swiper-wrapper">
                <template is="dom-repeat" items="[[images]]" as="image">
                    <img class="swiper-slide" src$="[[_getPath(image)]]">
                </template>
            </div>
        </div>
    </template>

    <script>
        /*global Swiper*/
        Polymer({
        	is: 'cosmoz-swiper',
        
        	properties: {
        		galleryTop: {
        			type: Object
        		},

        		galleryThumbs: {
        			type: Object
        		},
        
        		images: {
        			type: Array,
        			observer: '_imagesChanged'
        		}
        	},
        
        	detached() {
        		this._destroySwiper();
        	},
        
        	_getPath(image) {
        		return this.resolveUrl(image);
        	},
        
        	_imagesChanged() {
        		this.async(() => {
                    // if sync, swiper.size is undefined
                    // on updateSlides() function; line 1200 v4.0.1
        			this._initSwiper();
        		}, 1);
        	},
        
        	_destroySwiper() {
        		if (this.galleryTop) {
        			this.galleryTop.destroy();
        		}

        		if (this.galleryThumbs) {
        			this.galleryThumbs.destroy();
        		}
        	},
        
        	_initSwiper() {
        		this._destroySwiper();
        		this.galleryTop = new Swiper(this.$$('.gallery-top'), {
        			spaceBetween: 10,
        			observeParents: true,
        			navigation: {
        				nextEl: this.$$('.swiper-button-next'),
        				prevEl: this.$$('.swiper-button-prev'),
        			}
        		});
        
        		this.galleryThumbs = new Swiper(this.$$('.gallery-thumbs'), {
        			spaceBetween: 10,
        			centeredSlides: true,
        			slidesPerView: 'auto',
        			touchRatio: 0.2,
        			slideToClickedSlide: true
        		});
        
        		this.galleryTop.controller.control = this.galleryThumbs;
        		this.galleryThumbs.controller.control = this.galleryTop;
        	}
        });
    </script>
</dom-module>
