<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-meta/iron-meta.html">
<link rel="import" href="../cosmoz-behaviors/cosmoz-behaviors.html">
<link rel="import" href="../cosmoz-i18next/cosmoz-i18next.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html" />

<link rel="import" href="../iron-image/iron-image.html">

<link rel="import" href="../iron-ajax/iron-ajax.html">

<link rel="import" href="../skeleton-carousel/skeleton-carousel.html">

<link rel="import" href="photoswipe-boilerplate.html">

<dom-module id="cosmoz-image-viewer">
	<template>
		<style>
			:host {
				display: block;
				position: relative;
				@apply --layout-vertical;
				/* --cosmoz-image-viewer-height: 300px; */
				height: 100%;
			}

			:host([fullscreen]) .image {
				cursor: pointer;
			}

			#imageContainer {
				overflow-y: auto;
				will-change: transform;
			}

			.image {
				display: block;
				width: 100%;
				pointer-events: none;
			}

			#imageContainer:hover > .counter, #imageContainer:hover > .detach-btn {
				opacity: 1;
				background-color: rgba(0, 0, 0, 0.44);
				transition-delay: 0s;
			}

			.counter, .detach-btn {
				opacity: 0;
				-webkit-transition: opacity .25s ease-in-out;
				-moz-transition: opacity .25s ease-in-out;
				-ms-transition: opacity .25s ease-in-out;
				-o-transition: opacity .25s ease-in-out;
				transition: opacity .25s ease-in-out;
				transition-delay: 3s;
			}

			.counter {
				position: absolute;
				background-color: rgba(0, 0, 0, 0.13);
				color: #ffffff;
				z-index: +1;
				top: 18px;
				left: 50%;
				padding: 4px 10px;
    			border-radius: 30px;
				text-align: center;
				font-weight: 100;
				font-size: 0.8em;
			}

			.detach-btn {
				position: absolute;
				z-index: +1;
				right: 12px;
				top: 12px;
				color:rgba(255, 255, 255, 0.87);
				background-color: rgba(0, 0, 0, 0.13);
				border-radius: 20px;
			}

			@media (hover: none) {
				.detach-btn, .counter {
					opacity: 1;
					background-color: rgba(0, 0, 0, 0.26);
				}
			}

			#carousel {
				/* min-height: var(--cosmoz-image-viewer-height); */
				--skeleton-carousel-container: {
					position: relative;
				}
				--skeleton-carousel-nav: {
					background-color: rgba(0, 0, 0, 0.44);
					color: rgba(255, 255, 255, 0.87);
					top: 12px;
					position: absolute;
				};

				--skeleton-carousel-nav-disabled: {
					/* otherwise fullscreen gets triggerd on tap */
					pointer-events: all !important;
				};

				--skeleton-carousel-nav-next: {
					left: 56px;
				};

				--skeleton-carousel-nav-prev: {
					left: 12px;
				};

				--skeleton-carousel-dots: {
					position: absolute;
					top: 21px;
					background-color:rgba(128, 128, 128, 0.44);
					border-radius: 16px;
					height: 22px;
					padding: 0 4px;
					opacity: 0.67;
				};

				--skeleton-carousel-dot: {
					height: 22px;
					width: 22px;
					padding: 0 4px;
				}

				--skeleton-carousel-dot-color: rgba(0, 0, 0, 0.87);

				--skeleton-carousel-controls: {
					padding: 0;
				}
			}

		</style>
		<photoswipe-boilerplate pswp="{{_pswp}}"></photoswipe-boilerplate>

		<div id="imageContainer" on-scroll="scrollHandler">
			<paper-icon-button class="detach-btn"
				hidden$="[[ noDetach ]]"
				on-click="detach"
				icon="launch"
				title="[[ _('Detach image to separate window', t) ]]">
			</paper-icon-button>
			<div class="counter">[[selectedImageNumber]]/[[total]]</div>
			<skeleton-carousel id="carousel"
				selected-item="{{selectedItem}}"
				dots="[[dots]]"
				nav="[[nav]]"
				loop="[[loop]]"
				total="{{total}}"
				selected="{{selectedImageNumber}}">
				<template is="dom-repeat" items="[[_resolvedImages]]" as="image">
					<div on-click="_imageTapped">
						<img
							class="image"
							data-src$="[[image]]">
						</img>
					</div>
				</template>
			</skeleton-carousel>
		</div>

		<iron-ajax
			auto
			url="[[_detachedContentUrl]]"
			handle-as="text"
			last-response="{{_detachedWindowContent}}">
		</iron-ajax>

		<iron-meta id="meta" type="cosmoz-image-viewer" key="detachedWindow"></iron-meta>

	</template>
	<script type="text/javascript" src="cosmoz-image-viewer.js"></script>
</dom-module>
